<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VidStream</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Outfit',sans-serif;background:#0a0a0a;color:#fff;min-height:100vh}
    .header{position:fixed;top:0;left:0;right:0;height:56px;background:rgba(10,10,10,0.95);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,0.06);display:flex;align-items:center;padding:0 12px;z-index:1000;gap:12px}
    .logo{display:flex;align-items:center;gap:8px}
    .logo svg{flex-shrink:0}
    .logo-text{font-size:18px;font-weight:700;color:#fff}
    .search-form{flex:1;display:flex}
    .search-input{flex:1;height:40px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);border-radius:20px 0 0 20px;padding:0 16px;font-size:14px;color:#fff;font-family:inherit}
    .search-input:focus{outline:none;border-color:#ff3b30}
    .search-btn{height:40px;padding:0 16px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);border-left:none;border-radius:0 20px 20px 0;color:#888;cursor:pointer}
    .main{padding:68px 12px 12px}
    .categories{display:flex;gap:8px;margin-bottom:16px;overflow-x:auto;padding-bottom:8px}
    .chip{padding:8px 14px;border:none;border-radius:8px;font-size:13px;font-family:inherit;cursor:pointer;white-space:nowrap;background:rgba(255,255,255,0.08);color:#ddd}
    .chip.active{background:#ff3b30;color:#fff;font-weight:600}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .card{cursor:pointer}
    .thumb-wrap{position:relative;border-radius:12px;overflow:hidden;aspect-ratio:16/9;background:#1a1a1a}
    .thumb{width:100%;height:100%;object-fit:cover}
    .dur{position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,0.85);padding:3px 6px;border-radius:4px;font-size:11px;font-weight:600}
    .info{display:flex;gap:10px;padding:10px 0}
    .avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#ff3b30,#ff6b6b);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:600;flex-shrink:0}
    .avatar img{width:100%;height:100%;border-radius:50%;object-fit:cover}
    .meta{flex:1;min-width:0}
    .title{font-size:14px;font-weight:500;line-height:1.3;margin-bottom:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .channel{font-size:12px;color:#888}
    .stats{font-size:12px;color:#666}
    .error{padding:12px;background:rgba(255,59,48,0.1);border:1px solid rgba(255,59,48,0.3);border-radius:8px;margin-bottom:12px;color:#ff6b6b;font-size:13px;display:none}
    .loader{text-align:center;padding:20px;color:#888;font-size:14px;display:none}
    .loader.active{display:block}
    @keyframes spin{to{transform:rotate(360deg)}}
    .spinner{display:inline-block;width:20px;height:20px;border:2px solid #333;border-top-color:#ff3b30;border-radius:50%;animation:spin 0.8s linear infinite;margin-right:8px;vertical-align:middle}
    .modal{position:fixed;inset:0;background:#000;z-index:2000;display:none;flex-direction:column}
    .modal.active{display:flex}
    .modal-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(20,20,20,0.98)}
    .modal-title{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;margin-right:12px}
    .close{background:rgba(255,255,255,0.1);border:none;border-radius:50%;width:36px;height:36px;color:#fff;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center}
    .player-wrap{flex:1;display:flex;align-items:center;justify-content:center;background:#000;position:relative;min-height:200px}
    .player-info{padding:16px;background:linear-gradient(to bottom,rgba(20,20,20,0.98),#0a0a0a)}
    .player-title{font-size:15px;font-weight:600;margin-bottom:12px;line-height:1.4}
    .player-meta{display:flex;align-items:center;gap:12px}
    .player-avatar{width:40px;height:40px;border-radius:50%;object-fit:cover}
    .player-avatar-placeholder{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#ff3b30,#ff6b6b);display:flex;align-items:center;justify-content:center;font-weight:600}
    .player-channel{font-size:14px;font-weight:500}
    .player-stats{font-size:12px;color:#888}
    .vid-controls{display:flex;gap:8px;margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.1)}
    .ctrl-btn{flex:1;padding:12px;background:rgba(255,255,255,0.08);border:none;border-radius:8px;color:#fff;font-family:inherit;font-size:13px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px}
    .ctrl-btn.primary{background:#ff3b30}
    .up-next{padding:12px 16px;background:rgba(255,255,255,0.03);border-top:1px solid rgba(255,255,255,0.06)}
    .up-next-label{font-size:11px;color:#888;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px}
    .up-next-card{display:flex;gap:10px;cursor:pointer}
    .up-next-thumb{width:100px;aspect-ratio:16/9;border-radius:6px;object-fit:cover;background:#1a1a1a}
    .up-next-info{flex:1;min-width:0}
    .up-next-title{font-size:13px;font-weight:500;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:4px}
    .up-next-channel{font-size:11px;color:#888}
    .blocked{text-align:center;padding:40px 20px}
    .blocked h3{font-size:16px;margin:16px 0 8px}
    .blocked p{color:#888;font-size:13px}
    #ytplayer{width:100%;height:100%;position:absolute;top:0;left:0}
    @media(min-width:600px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:900px){.grid{grid-template-columns:repeat(3,1fr)}}
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <svg width="28" height="20" viewBox="0 0 28 20"><rect width="28" height="20" rx="4" fill="#ff3b30"/><path d="M11 6L18 10L11 14V6Z" fill="#fff"/></svg>
      <span class="logo-text">VidStream</span>
    </div>
    <form class="search-form" onsubmit="search(event)">
      <input type="text" class="search-input" id="q" placeholder="Search...">
      <button type="submit" class="search-btn">üîç</button>
    </form>
  </header>
  <main class="main">
    <div class="categories" id="cats"></div>
    <div class="error" id="err"></div>
    <div class="grid" id="grid"></div>
    <div class="loader" id="loader"><span class="spinner"></span>Loading more...</div>
  </main>
  <div class="modal" id="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Now Playing</div>
      <button class="close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="player-wrap" id="playerWrap"></div>
    <div class="player-info">
      <div class="player-title" id="pTitle"></div>
      <div class="player-meta">
        <div id="pAvatarWrap"></div>
        <div><div class="player-channel" id="pChannel"></div><div class="player-stats" id="pStats"></div></div>
      </div>
      <div class="vid-controls">
        <button class="ctrl-btn" onclick="playPrev()">‚èÆ Prev</button>
        <button class="ctrl-btn primary" onclick="playNext()">Next ‚è≠</button>
      </div>
    </div>
    <div class="up-next" id="upNext">
      <div class="up-next-label">Up Next</div>
      <div class="up-next-card" onclick="playNext()">
        <img class="up-next-thumb" id="nextThumb" src="">
        <div class="up-next-info">
          <div class="up-next-title" id="nextTitle"></div>
          <div class="up-next-channel" id="nextChannel"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
const API='AIzaSyAqVubsd_VmUB2E3DIi99Yw5VfInwKNBac';
const cats=[{id:'all',name:'All',q:''},{id:'music',name:'Music',q:'music'},{id:'gaming',name:'Gaming',q:'gaming'},{id:'news',name:'News',q:'news'},{id:'sports',name:'Sports',q:'sports'},{id:'learning',name:'Learning',q:'tutorial'}];
let active='all',vids=[],nextPage='',currentQuery='',isLoading=false,currentIdx=0,ytPlayer=null,apiReady=false;

function onYouTubeIframeAPIReady(){apiReady=true}

const fmtViews=n=>{if(!n)return'0';n=parseInt(n);return n>=1e6?(n/1e6).toFixed(1)+'M':n>=1e3?(n/1e3).toFixed(1)+'K':n.toString()};
const fmtDur=d=>{if(!d)return'0:00';const m=d.match(/PT(\d+H)?(\d+M)?(\d+S)?/);if(!m)return'0:00';const h=parseInt(m[1])||0,min=parseInt(m[2])||0,s=parseInt(m[3])||0;return h?`${h}:${String(min).padStart(2,'0')}:${String(s).padStart(2,'0')}`:`${min}:${String(s).padStart(2,'0')}`};
const fmtDate=d=>{if(!d)return'';const days=Math.floor((new Date()-new Date(d))/864e5);return days>=365?Math.floor(days/365)+'y ago':days>=30?Math.floor(days/30)+'mo ago':days>=7?Math.floor(days/7)+'w ago':days>0?days+'d ago':'Today'};

function renderCats(){document.getElementById('cats').innerHTML=cats.map(c=>`<button class="chip ${active===c.id?'active':''}" onclick="selCat('${c.id}')">${c.name}</button>`).join('')}

function renderVids(){
  const g=document.getElementById('grid');
  if(!vids.length){g.innerHTML='<p style="color:#666;text-align:center;grid-column:1/-1;padding:40px">No videos found</p>';return}
  g.innerHTML=vids.map((v,i)=>`<div class="card" onclick="play(${i})"><div class="thumb-wrap"><img class="thumb" src="${v.thumb}" loading="lazy"><span class="dur">${v.dur}</span></div><div class="info">${v.avatar?`<div class="avatar"><img src="${v.avatar}"></div>`:`<div class="avatar">${v.channel[0]}</div>`}<div class="meta"><div class="title">${v.title}</div><div class="channel">${v.channel}</div><div class="stats">${v.views} ‚Ä¢ ${v.time}</div></div></div></div>`).join('');
}

async function fetchVids(q='',cq='',loadMore=false){
  if(isLoading)return;
  isLoading=true;
  if(!loadMore){vids=[];nextPage='';currentQuery=q||cq||'trending';document.getElementById('grid').innerHTML='<p style="color:#666;text-align:center;grid-column:1/-1;padding:40px">Loading...</p>'}
  document.getElementById('loader').classList.toggle('active',loadMore);
  document.getElementById('err').style.display='none';
  try{
    let url=`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=12&q=${encodeURIComponent(currentQuery)}&type=video&key=${API}`;
    if(loadMore&&nextPage)url+=`&pageToken=${nextPage}`;
    const sr=await(await fetch(url)).json();
    if(sr.error)throw new Error(sr.error.message);
    nextPage=sr.nextPageToken||'';
    const ids=sr.items.map(i=>i.id.videoId).join(',');
    const dr=await(await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics,status&id=${ids}&key=${API}`)).json();
    const cids=[...new Set(dr.items.map(i=>i.snippet.channelId))].join(',');
    const cr=await(await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${cids}&key=${API}`)).json();
    const avatars={};cr.items?.forEach(c=>avatars[c.id]=c.snippet.thumbnails.default.url);
    const newVids=dr.items.map(v=>({id:v.id,title:v.snippet.title,channel:v.snippet.channelTitle,avatar:avatars[v.snippet.channelId]||'',views:fmtViews(v.statistics.viewCount),time:fmtDate(v.snippet.publishedAt),dur:fmtDur(v.contentDetails.duration),thumb:v.snippet.thumbnails.high?.url||v.snippet.thumbnails.medium?.url,embed:v.status?.embeddable!==false}));
    vids=loadMore?[...vids,...newVids]:newVids;
    renderVids();
  }catch(e){document.getElementById('err').textContent=e.message;document.getElementById('err').style.display='block';if(!loadMore){vids=[];renderVids()}}
  document.getElementById('loader').classList.remove('active');
  isLoading=false;
}

window.addEventListener('scroll',()=>{if(isLoading||!nextPage)return;if(window.innerHeight+window.scrollY>=document.body.offsetHeight-500)fetchVids('','',true)});

function selCat(id){active=id;renderCats();fetchVids('',cats.find(c=>c.id===id).q)}
function search(e){e.preventDefault();const q=document.getElementById('q').value.trim();if(q){active='all';renderCats();fetchVids(q)}}

function onPlayerStateChange(event){if(event.data===YT.PlayerState.ENDED)playNext()}

function play(i){
  currentIdx=i;
  const v=vids[i];
  document.getElementById('modalTitle').textContent=v.title;
  document.getElementById('pTitle').textContent=v.title;
  document.getElementById('pChannel').textContent=v.channel;
  document.getElementById('pStats').textContent=v.views+' ‚Ä¢ '+v.time;
  document.getElementById('pAvatarWrap').innerHTML=v.avatar?`<img class="player-avatar" src="${v.avatar}">`:`<div class="player-avatar-placeholder">${v.channel[0]}</div>`;
  const nextIdx=(i+1)%vids.length;
  const nextVid=vids[nextIdx];
  document.getElementById('nextThumb').src=nextVid.thumb;
  document.getElementById('nextTitle').textContent=nextVid.title;
  document.getElementById('nextChannel').textContent=nextVid.channel;
  const w=document.getElementById('playerWrap');
  if(v.embed&&apiReady){
    w.innerHTML='<div id="ytplayer"></div>';
    if(ytPlayer){ytPlayer.destroy();ytPlayer=null}
    ytPlayer=new YT.Player('ytplayer',{videoId:v.id,playerVars:{autoplay:1,controls:1,modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,fs:1,playsinline:1},events:{onStateChange:onPlayerStateChange}});
  }else if(v.embed){
    w.innerHTML=`<iframe id="ytplayer" src="https://www.youtube.com/embed/${v.id}?autoplay=1&rel=0&modestbranding=1&iv_load_policy=3&playsinline=1" style="width:100%;height:100%;border:none" allowfullscreen allow="autoplay"></iframe>`;
  }else{
    w.innerHTML=`<div class="blocked"><div style="font-size:48px">üîí</div><h3>This video can't play here</h3><p>Tap "Next" to watch another video</p></div>`;
  }
  document.getElementById('modal').classList.add('active');
}

function playNext(){play((currentIdx+1)%vids.length)}
function playPrev(){play((currentIdx-1+vids.length)%vids.length)}
function closeModal(){document.getElementById('modal').classList.remove('active');if(ytPlayer&&ytPlayer.destroy){ytPlayer.destroy();ytPlayer=null}document.getElementById('playerWrap').innerHTML=''}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal();if(document.getElementById('modal').classList.contains('active')){if(e.key==='ArrowRight')playNext();if(e.key==='ArrowLeft')playPrev()}});

renderCats();
fetchVids();
</script>
</body>
</html>
